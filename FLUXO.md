# ğŸ”„ Fluxo de Dados - Sistema E-Commerce

## ğŸ“Š Arquitetura Completa

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Cliente   â”‚
â”‚  (Browser)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ HTTP Request + JWT
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        API GATEWAY (5001)           â”‚
â”‚  - Valida JWT                       â”‚
â”‚  - Roteia requisiÃ§Ãµes               â”‚
â”‚  - Repassa headers                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚
       â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Estoque    â”‚    â”‚    Vendas      â”‚
â”‚  Service    â”‚â—„â”€â”€â”€â”¤    Service     â”‚
â”‚  (5002)     â”‚    â”‚    (5000)      â”‚
â”‚             â”‚    â”‚                â”‚
â”‚ - Produtos  â”‚    â”‚ - Pedidos      â”‚
â”‚ - Auth JWT  â”‚    â”‚ - Auth JWT     â”‚
â”‚ - Consumer  â”‚    â”‚ - Producer     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚
       â”‚                â”‚ Publish Message
       â”‚           â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
       â”‚           â”‚ RabbitMQ â”‚
       â”‚           â”‚  Queue   â”‚
       â”‚           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚
       â”‚ Consume        â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EstoqueDB   â”‚  â”‚   VendasDB     â”‚
â”‚ SQL Server   â”‚  â”‚  SQL Server    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Fluxo 1: Cadastro de Produto

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cliente â”‚      â”‚ Gateway â”‚      â”‚ Estoque  â”‚      â”‚   DB   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                â”‚                â”‚                â”‚
     â”‚ 1. POST        â”‚                â”‚                â”‚
     â”‚ /produtos      â”‚                â”‚                â”‚
     â”‚ + JWT Admin    â”‚                â”‚                â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚                â”‚
     â”‚                â”‚ 2. Valida JWT  â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚ 3. Forward     â”‚                â”‚
     â”‚                â”‚ + Headers      â”‚                â”‚
     â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚
     â”‚                â”‚                â”‚ 4. Valida Role â”‚
     â”‚                â”‚                â”‚ (Administrador)â”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚ 5. INSERT      â”‚
     â”‚                â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                â”‚                â”‚                â”‚
     â”‚                â”‚                â”‚ 6. OK          â”‚
     â”‚                â”‚                â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                â”‚ 7. 201 Created â”‚                â”‚
     â”‚                â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
     â”‚ 8. Produto     â”‚                â”‚                â”‚
     â”‚    Criado      â”‚                â”‚                â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚                â”‚
     â”‚                â”‚                â”‚                â”‚
```

## ğŸ›’ Fluxo 2: CriaÃ§Ã£o de Pedido (Principal)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cliente â”‚  â”‚ Gateway â”‚  â”‚ Vendas â”‚  â”‚ Estoque â”‚  â”‚RabbitMQ â”‚  â”‚   DB   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚            â”‚            â”‚            â”‚            â”‚            â”‚
     â”‚ 1. POST    â”‚            â”‚            â”‚            â”‚            â”‚
     â”‚ /pedidos   â”‚            â”‚            â”‚            â”‚            â”‚
     â”‚ + JWT      â”‚            â”‚            â”‚            â”‚            â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚            â”‚            â”‚            â”‚            â”‚
     â”‚            â”‚ 2. Valida  â”‚            â”‚            â”‚            â”‚
     â”‚            â”‚    JWT     â”‚            â”‚            â”‚            â”‚
     â”‚            â”‚            â”‚            â”‚            â”‚            â”‚
     â”‚            â”‚ 3. Forward â”‚            â”‚            â”‚            â”‚
     â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚            â”‚            â”‚            â”‚
     â”‚            â”‚            â”‚ 4. Valida  â”‚            â”‚            â”‚
     â”‚            â”‚            â”‚    Role    â”‚            â”‚            â”‚
     â”‚            â”‚            â”‚            â”‚            â”‚            â”‚
     â”‚            â”‚            â”‚ 5. GET /produtos/{id}  â”‚            â”‚
     â”‚            â”‚            â”‚    (Validar Estoque)   â”‚            â”‚
     â”‚            â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚            â”‚            â”‚
     â”‚            â”‚            â”‚            â”‚ 6. SELECT  â”‚            â”‚
     â”‚            â”‚            â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚            â”‚
     â”‚            â”‚            â”‚            â”‚            â”‚            â”‚
     â”‚            â”‚            â”‚            â”‚ 7. Produto â”‚            â”‚
     â”‚            â”‚            â”‚            â”‚ + Qtd: 10  â”‚            â”‚
     â”‚            â”‚            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚            â”‚
     â”‚            â”‚            â”‚            â”‚            â”‚            â”‚
     â”‚            â”‚            â”‚ 8. Estoque OK!          â”‚            â”‚
     â”‚            â”‚            â”‚    (10 >= 2)            â”‚            â”‚
     â”‚            â”‚            â”‚                         â”‚            â”‚
     â”‚            â”‚            â”‚ 9. INSERT Pedido        â”‚            â”‚
     â”‚            â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚            â”‚
     â”‚            â”‚            â”‚                         â”‚            â”‚
     â”‚            â”‚            â”‚ 10. OK                  â”‚            â”‚
     â”‚            â”‚            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
     â”‚            â”‚            â”‚                         â”‚            â”‚
     â”‚            â”‚            â”‚ 11. Publish Message     â”‚            â”‚
     â”‚            â”‚            â”‚    {PedidoId: 1,        â”‚            â”‚
     â”‚            â”‚            â”‚     Itens: [{           â”‚            â”‚
     â”‚            â”‚            â”‚       ProdutoId: 1,     â”‚            â”‚
     â”‚            â”‚            â”‚       Quantidade: 2     â”‚            â”‚
     â”‚            â”‚            â”‚     }]}                 â”‚            â”‚
     â”‚            â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚            â”‚
     â”‚            â”‚            â”‚                         â”‚            â”‚
     â”‚            â”‚ 12. 201    â”‚                         â”‚            â”‚
     â”‚            â”‚    Created â”‚                         â”‚            â”‚
     â”‚            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚            â”‚
     â”‚ 13. Pedido â”‚            â”‚                         â”‚            â”‚
     â”‚     Criado â”‚            â”‚                         â”‚            â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚                         â”‚            â”‚
     â”‚            â”‚            â”‚                         â”‚            â”‚
     â”‚                         â”‚                         â”‚            â”‚
     â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”     â”‚
     â”‚            â”‚  PROCESSAMENTO ASSÃNCRONO                   â”‚     â”‚
     â”‚            â”‚  (Consumer em Background)                   â”‚     â”‚
     â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â”‚
     â”‚                         â”‚                         â”‚            â”‚
     â”‚                    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                    â”‚            â”‚
     â”‚                    â”‚ Estoque â”‚                    â”‚            â”‚
     â”‚                    â”‚Consumer â”‚                    â”‚            â”‚
     â”‚                    â”‚(BgServ) â”‚                    â”‚            â”‚
     â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                    â”‚            â”‚
     â”‚                         â”‚                         â”‚            â”‚
     â”‚                         â”‚ 14. Consume Message     â”‚            â”‚
     â”‚                         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
     â”‚                         â”‚                         â”‚            â”‚
     â”‚                         â”‚ 15. Deserialize JSON    â”‚            â”‚
     â”‚                         â”‚     Parse ProdutoId: 1  â”‚            â”‚
     â”‚                         â”‚     Parse Quantidade: 2 â”‚            â”‚
     â”‚                         â”‚                         â”‚            â”‚
     â”‚                         â”‚ 16. SELECT Produto WHERE Id = 1      â”‚
     â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                         â”‚                         â”‚            â”‚
     â”‚                         â”‚ 17. Produto (Qtd: 10)   â”‚            â”‚
     â”‚                         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                         â”‚                         â”‚            â”‚
     â”‚                         â”‚ 18. UPDATE Produto      â”‚            â”‚
     â”‚                         â”‚     SET Quantidade = 8  â”‚            â”‚
     â”‚                         â”‚     WHERE Id = 1        â”‚            â”‚
     â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                         â”‚                         â”‚            â”‚
     â”‚                         â”‚ 19. OK                  â”‚            â”‚
     â”‚                         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                         â”‚                         â”‚            â”‚
     â”‚                         â”‚ 20. BasicAck            â”‚            â”‚
     â”‚                         â”‚     (confirma msg)      â”‚            â”‚
     â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚            â”‚
     â”‚                         â”‚                         â”‚            â”‚
     â”‚                    LOG: "Estoque atualizado:      â”‚            â”‚
     â”‚                          Produto 1: 10 -> 8"      â”‚            â”‚
     â”‚                                                    â”‚            â”‚
```

## ğŸ”’ Fluxo 3: AutenticaÃ§Ã£o JWT

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cliente â”‚      â”‚   Auth   â”‚      â”‚  Token  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                â”‚                 â”‚
     â”‚ 1. POST        â”‚                 â”‚
     â”‚ /auth/login    â”‚                 â”‚
     â”‚ {user, pass}   â”‚                 â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚
     â”‚                â”‚ 2. Valida       â”‚
     â”‚                â”‚    Credenciais  â”‚
     â”‚                â”‚                 â”‚
     â”‚                â”‚ 3. Gera Token   â”‚
     â”‚                â”‚    + Claims     â”‚
     â”‚                â”‚    + Expiry     â”‚
     â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                â”‚                 â”‚
     â”‚                â”‚ 4. Token JWT    â”‚
     â”‚                â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚ 5. Return      â”‚                 â”‚
     â”‚    {token}     â”‚                 â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
     â”‚                â”‚                 â”‚
     â”‚ 6. PrÃ³ximas    â”‚                 â”‚
     â”‚    RequisiÃ§Ãµes â”‚                 â”‚
     â”‚    Authorization: Bearer TOKEN   â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
     â”‚                                  â”‚
```

## âŒ Fluxo 4: Erro - Estoque Insuficiente

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cliente â”‚  â”‚ Vendas  â”‚  â”‚ Estoque â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚            â”‚            â”‚
     â”‚ POST       â”‚            â”‚
     â”‚ /pedidos   â”‚            â”‚
     â”‚ Qtd: 100   â”‚            â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚            â”‚
     â”‚            â”‚ GET /produtos/{id}
     â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚            â”‚            â”‚
     â”‚            â”‚ Produto    â”‚
     â”‚            â”‚ Qtd: 10    â”‚
     â”‚            â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚            â”‚            â”‚
     â”‚            â”‚ âš ï¸ ERRO!   â”‚
     â”‚            â”‚ 10 < 100   â”‚
     â”‚            â”‚            â”‚
     â”‚ 400 Bad    â”‚            â”‚
     â”‚ Request    â”‚            â”‚
     â”‚ "Estoque   â”‚            â”‚
     â”‚ insufic."  â”‚            â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
     â”‚            â”‚            â”‚
     â”‚ âŒ Pedido NÃƒO Ã© criado  â”‚
     â”‚ âŒ Mensagem NÃƒO enviada â”‚
     â”‚ âŒ Estoque NÃƒO alterado â”‚
     â”‚                         â”‚
```

## ğŸ”„ Componentes e Responsabilidades

### API Gateway (5001)
- âœ… Ponto Ãºnico de entrada
- âœ… ValidaÃ§Ã£o de JWT
- âœ… Roteamento inteligente
- âœ… Repasse de headers
- âœ… Tratamento de erros

### Estoque Service (5002)
- âœ… CRUD de produtos
- âœ… AutenticaÃ§Ã£o JWT
- âœ… RabbitMQ Consumer (Background)
- âœ… AtualizaÃ§Ã£o automÃ¡tica de estoque
- âœ… Logs detalhados

### Vendas Service (5000)
- âœ… CRUD de pedidos
- âœ… AutenticaÃ§Ã£o JWT
- âœ… ValidaÃ§Ã£o HTTP de estoque
- âœ… RabbitMQ Producer
- âœ… Mensagens estruturadas

### RabbitMQ
- âœ… Fila persistente
- âœ… Mensagens JSON
- âœ… Ack/Nack manual
- âœ… Garantia de entrega

## ğŸ“ˆ CenÃ¡rios Testados

| CenÃ¡rio | Resultado Esperado | Status |
|---------|-------------------|--------|
| Cadastrar produto sem token | 401 Unauthorized | âœ… |
| Cadastrar produto com token cliente | 403 Forbidden | âœ… |
| Cadastrar produto com token admin | 201 Created | âœ… |
| Criar pedido com estoque OK | 201 + Estoque reduzido | âœ… |
| Criar pedido sem estoque | 400 Bad Request | âœ… |
| Criar pedido produto inexistente | 400 Bad Request | âœ… |
| Consultar produtos sem token | 401 Unauthorized | âœ… |
| RabbitMQ Consumer processar mensagem | Estoque atualizado | âœ… |
| Gateway rotear para Estoque | RequisiÃ§Ã£o repassada | âœ… |
| Gateway rotear para Vendas | RequisiÃ§Ã£o repassada | âœ… |

## ğŸ¯ Pontos CrÃ­ticos Implementados

1. âœ… **ValidaÃ§Ã£o SÃ­ncrona**: VendasService consulta EstoqueService ANTES de criar pedido
2. âœ… **AtualizaÃ§Ã£o AssÃ­ncrona**: Estoque reduzido via RabbitMQ APÃ“S pedido criado
3. âœ… **Mensagem Estruturada**: JSON com todos os dados necessÃ¡rios
4. âœ… **Consumer AutomÃ¡tico**: BackgroundService inicia com a aplicaÃ§Ã£o
5. âœ… **Tratamento de Erros**: Try-catch em operaÃ§Ãµes crÃ­ticas
6. âœ… **Logging Completo**: Rastreabilidade de todas as operaÃ§Ãµes
7. âœ… **JWT End-to-End**: AutenticaÃ§Ã£o em todos os serviÃ§os
8. âœ… **Gateway Funcional**: Repasse correto de requisiÃ§Ãµes e tokens

---

**Este fluxo garante que:**
- Pedidos sÃ³ sÃ£o criados se houver estoque
- Estoque Ã© atualizado automaticamente
- Sistema Ã© escalÃ¡vel e resiliente
- ComunicaÃ§Ã£o entre serviÃ§os Ã© eficiente
- SeguranÃ§a via JWT em todos os endpoints